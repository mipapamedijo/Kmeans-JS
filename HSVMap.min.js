var counter,dropError,loading=!0,dropped=!1;let pLoad,pLoaded,pError;var boxSizeSlider,imgCheckBox,colorsList=[];let useImg=!1;var csvData,dSize,cols,rows,array,top,bottom,tall,divs,sqR,posX,posY,posZ,h,s,v,boxS,data=[],fullDivs=1e3;let boxSelected;var zoom,inc,rotInc,rotation,screenState,imageS,path,infoPAlpha;let frameP,tH,tS,tV,imgArray=[];var img=[],hsv_3d=function(a){a.dirX,a.dirY,a.infoP,a.data=data,a.images=[],a.setup=function(){top=0,bottom=100,tall=100,divs=12,boxS=3,zoom=3,inc=.2,rotInc=185,rotation=a.PI/rotInc,screenState=0,cols=3,rows=a.int(dSize/cols),array=[],counter=0,(boxSizeSlider=a.createSlider(.5,10,boxS,.25)).class("slider"),boxSizeSlider.hide(),a.canvas=a.createCanvas(window.innerWidth,500,a.WEBGL),a.canvas.parent("hsv_map"),a.colorMode(a.HSB,360,100,100),a.rectMode(a.CENTER),tH=a.createGraphics(100,100),tS=a.createGraphics(100,100),tV=a.createGraphics(100,100),pl=a.createGraphics(10,10),(imgCheckBox=a.createCheckbox("Use Frames as texture",!0)).parent("checkbox")},a.draw=function(){a.clear(),a.dirX=2*(a.mouseX/a.width-.5),a.dirY=2*(a.mouseY/a.height-.5),a.ambientLight(100),a.ortho(-a.width/2,a.width/2,-a.height/2,a.height/2,0,1e4),a.camera(a.width/2*zoom,a.height/2*zoom,a.height/3/a.tan(50*a.PI/180)*zoom,a.width/2*zoom,a.height/2*zoom,0,0,1,0),a.push(),a.scale(zoom),a.translate(a.width/2,a.height-a.height/2.5,zoom),a.rotateX(-a.PI),a.rotateY(a.frameCount*rotation),loading?(rotation=.1,drawCone(top,bottom,tall,fullDivs)):(boxSizeSlider.parent("sliders"),boxSizeSlider.show(),boxS=boxSizeSlider.value(),rotation=a.PI/rotInc,drawCone(top,bottom,tall,divs),a.push(),a.translate(0,tall,0),a.rotateZ(a.PI),a.rotateY(-a.PI/2),drawHSVPoints(a.data,tall),a.pop(),a.translate(0,0,0),drawAxis()),a.pop(),useImg=1==imgCheckBox.checked()},a.mouseClicked=function(){},a.keyPressed=function(){"w"==a.key&&(zoom+=inc,a.print("ZOOM:"+zoom)),"s"==a.key&&((zoom-=inc)<0&&(zoom=.05),a.print("ZOOM:"+zoom)),"d"==a.key&&(rotation=a.PI/rotInc++,a.print("ROTATION:"+rotation)),"a"==a.key&&(rotation=a.PI/rotInc--,a.print("ROTATION:"+rotation)),a.keyCode==a.ESCAPE&&(a.frameRate(0),a.print("ROTATION:"+rotation)),a.keyCode==a.ENTER&&(a.frameRate(8),a.print("ROTATION:"+rotation)),a.keyCode==a.TAB&&(screenState=0==screenState?1:0)},a.windowResized=function(){a.resizeCanvas(window.innerWidth,500)}};function drawCone(a,t,o,e){var r=0,p=p5_a.TWO_PI/e;if(1==screenState);else{for(p5_a.push(),p5_a.beginShape(p5_a.LINES),p5_a.fill(0),i=0;i<e+1;++i)p5_a.push(),p5_a.strokeWeight(1.5),p5_a.stroke(i*(360/e),50,100,10),p5_a.line(a*p5_a.cos(r),0,a*p5_a.sin(r),t*p5_a.cos(r),o,t*p5_a.sin(r)),p5_a.pop(),r+=p;p5_a.endShape(),p5_a.pop()}}function drawHSVPoints(a,t){dSize=colorsList.length;p5_a.int(dSize/3);for(sqR=p5_a.int(Math.floor(p5_a.sqrt(dSize))),i=0;i<dSize;i++){posX=0,posY=0,posZ=0,h=colorsList[i].h,s=colorsList[i].s,v=colorsList[i].v,p5_a.push(),p5_a.fill(h,s,v),p5_a.noStroke();var o,e=(i%noK-i)/-noK;if(1==screenState)0==loading&&0==useImg&&(p5_a.push(),p5_a.rotateX(p5_a.PI),p5_a.rotateZ(p5_a.PI/2),p5_a.translate(-t/2,0,0),posY=sqR/2*boxS-i%sqR*boxS,posX=sqR/2*boxS-i/sqR*boxS,posZ=0,p5_a.translate(posX,posY,posZ),p5_a.rotateZ(p5_a.PI),p5_a.rotateX(0),p5_a.box(boxS),p5_a.pop()),0==loading&&1==useImg&&(p5_a.push(),p5_a.rotateX(p5_a.PI),p5_a.rotateZ(p5_a.PI/2),p5_a.translate(-t/2,0,0),posY=sqR/2*boxS-i%sqR*boxS,posX=sqR/2*boxS-i/sqR*boxS,posZ=0,p5_a.translate(posX,posY,posZ),p5_a.rotateZ(p5_a.PI),p5_a.rotateX(0),p5_a.texture(imgArray[e]),p5_a.box(boxS),p5_a.pop());else(o=s-(100-v))<0&&(o=0==s?0:v%s),posX=o*p5_a.sin(h*p5_a.PI/180),posY=t-v,posZ=o*p5_a.cos(h*p5_a.PI/180),p5_a.translate(posX,posY,posZ),p5_a.rotateZ(p5_a.frameCount*rotation),0==loading&&0==useImg&&p5_a.ambientMaterial(h,s,v),0==loading&&1==useImg&&p5_a.texture(imgArray[e]),p5_a.sphere(boxS),p5_a.pop()}}function drawAxis(){1==screenState||(p5_a.rotateX(-p5_a.PI),p5_a.push(),p5_a.strokeWeight(1),p5_a.stroke(0,0,80),p5_a.line(0,-100,0,0,0,0),p5_a.line(0,0,0,-100,0,0),p5_a.line(0,0,0,0,0,-100),p5_a.push(),p5_a.translate(-100,0,0),tH.fill(125),tH.textSize(25),tH.text("H",50,25),p5_a.beginShape(),p5_a.texture(tH),p5_a.plane(25,25),p5_a.endShape(),p5_a.pop(),p5_a.push(),p5_a.translate(0,0,-100),tS.fill(125),tS.textSize(25),tS.text("S",50,25),p5_a.beginShape(),p5_a.texture(tS),p5_a.plane(25,25),p5_a.endShape(),p5_a.pop(),p5_a.push(),p5_a.translate(0,-100,0),tV.fill(125),tV.textSize(25),tV.text("V",50,25),p5_a.beginShape(),p5_a.texture(tV),p5_a.plane(25,25),p5_a.endShape(),p5_a.pop(),p5_a.pop())}function loadFrames(a){var t=a;loading=!0,p5_a.loadImage(t,loadedImages)}function loadedImages(a){imgArray.push(a),print(imgArray.length),imgArray.length==rows?loading=!1:imgArray.length>0?(loading=!1,noK>1?imgCheckBox.disabled:imgCheckBox.enabled):loading=!0}function initArray2D(a){var t=[];if(cols=3,rows=p5_a.int(dSize/cols),a){for(var o=0;o<cols;o++){t[o]=[];for(var e=0;e<rows;e++)t[o][e]=null}p5_b.print(t),setData(t,a)}else array[0]=1,array[0][0]=1,array[1][0]=1,array[2][0]=1,data=array}function setData(a,t){var o,e,r,i=0,p=cols;p5_b.print(rows);for(var s=0;s<rows;s++){a[0][s]=o,a[1][s]=e,a[2][s]=r;for(var n=0;n<dSize;n++)o=t[i],e=t[i+1],r=t[i+2],n+=p;i+=p}data=a}function colorArray(){var a=dSize/3,t=p5_b.width/a;p5_b.print("ONE DIMENSION ARRAY OF : "+a+" COLORS");for(let o=0;o<a;o++){let a=data[0][o],e=data[1][o],r=data[2][o],i=o*t,p=0,s=t,n=p5_b.height,l=new Color(a,e,r,s,n,i,p);p5_b.colors.push(l)}}function lookOver(){for(let t=0;t<p5_b.colors.length;t++){if(p5_b.colors[t].over(p5_b.mouseX,p5_b.mouseY)){p5_b.colors[t].changeColor(100),p5_b.print("OVER AT: "+3*t),p5_b.imgIndex=3*t,boxSelected=10;var a="FRAME # "+p5_b.imgIndex;frameP.html(a)}else p5_b.colors[t].changeColor(80);p5_b.colors[t].show()}}function drawImages(a){var t;t="data/frames/"+fileName+"/frame_"+a+".jpg",p5_b.d.id("img_area"),p5_b.d.style("background-image","url("+t+")")}class Color{constructor(a,t,o,e,r,i,p){this.h=a,this.s=t,this.v=o,this.w=e,this.t=r,this.x=i,this.y=p,this.a=0}changeColor(a){this.a=a}over(a,t){return a>=this.x&&a<=this.x+this.w&&t>=this.y&&t<=this.y+p5_b.height}show(){p5_b.noStroke(),p5_b.translate(0,this.dist),p5_b.fill(this.h,this.s,this.v,this.a),p5_b.rect(this.x,this.y,this.w,this.t)}}
